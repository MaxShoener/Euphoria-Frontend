<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Euphoria Proxy</title>
<style>
  :root {
    --bg: #000;
    --fg: #0f0;
    --border: #0a0;
  }
  body {
    background: var(--bg);
    color: var(--fg);
    font-family: "Consolas", "Courier New", monospace;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }
  #toolbar {
    background: #080808;
    border-bottom: 1px solid var(--border);
    padding: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }
  button, input {
    background: #000;
    color: var(--fg);
    border: 1px solid var(--border);
    padding: 8px 12px;
    font-size: 14px;
    border-radius: 4px;
    outline: none;
  }
  input {
    width: 45%;
  }
  button:hover {
    background: #0f0;
    color: #000;
  }
  #status {
    text-align: right;
    padding: 4px 12px;
    font-size: 12px;
    border-bottom: 1px solid var(--border);
  }
  iframe {
    flex: 1;
    border: none;
    width: 100%;
    background: #111;
  }
</style>
</head>
<body>
  <div id="toolbar">
    <button id="back">←</button>
    <button id="forward">→</button>
    <button id="refresh">⟳</button>
    <button id="home">⌂</button>
    <input id="url" placeholder="Enter URL...">
    <button id="go">Go</button>
    <button id="fullscreen">⛶</button>
    <button id="switch">Switch Engine</button>
  </div>
  <div id="status">Engine: loading...</div>
  <iframe id="view" src=""></iframe>

<script>
const backend = "https://ideological-merna-maxshoener-af9383a9.koyeb.app";
const frame = document.getElementById("view");
const urlBox = document.getElementById("url");
const statusBox = document.getElementById("status");
let engine = "ultraviolet";
let lastURL = "";

async function updateEngineDisplay() {
  try {
    const res = await fetch(`${backend}/engine`);
    const j = await res.json();
    engine = j.engine;
    statusBox.textContent = "Engine: " + engine;
  } catch {
    statusBox.textContent = "Engine: offline";
  }
}

async function go(url) {
  if (!url.trim()) return;
  if (!/^https?:\/\//i.test(url)) url = "https://" + url;
  lastURL = url;
  urlBox.value = url;
  try {
    frame.src = `${backend}/proxy?url=${encodeURIComponent(url)}`;
  } catch {
    alert("Error loading site. Try switching engines or refreshing.");
  }
}

document.getElementById("go").onclick = () => go(urlBox.value);
document.getElementById("home").onclick = () => go("https://example.com");
document.getElementById("refresh").onclick = () => frame.src = `${backend}/proxy?url=${encodeURIComponent(lastURL)}`;
document.getElementById("back").onclick = () => frame.contentWindow?.history?.back?.();
document.getElementById("forward").onclick = () => frame.contentWindow?.history?.forward?.();
document.getElementById("fullscreen").onclick = async () => {
  if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
  else await document.exitFullscreen();
};
document.getElementById("switch").onclick = async () => {
  const newEngine = engine === "ultraviolet" ? "scramjet" : "ultraviolet";
  try {
    const res = await fetch(`${backend}/engine?set=${newEngine}`);
    const j = await res.json();
    engine = j.engine;
    statusBox.textContent = "Engine: " + engine;
  } catch {
    statusBox.textContent = "Engine: switch failed";
  }
};

// Run on load
updateEngineDisplay();
</script>
</body>
</html>