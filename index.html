<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Euphoria Proxy Interactive</title>
<style>
  body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; height:100vh; }
  #url-bar { display:flex; padding:10px; gap:5px; background:#222; }
  #url-bar input { flex:1; padding:5px; border:none; border-radius:3px; }
  #url-bar button { padding:5px 10px; border:none; border-radius:3px; background:#4caf50; color:white; cursor:pointer; }
  #browser-frame { flex:1; border:none; }
</style>
</head>
<body>
<div id="url-bar">
  <input type="text" id="url-input" placeholder="Enter URL..." />
  <button id="go-btn">Enter</button>
</div>
<iframe id="browser-frame"></iframe>

<script>
const backend = "https://wisp-server-w7nx.onrender.com";
let sessionId = null;
const iframe = document.getElementById("browser-frame");
const input = document.getElementById("url-input");

async function createSession() {
  const res = await fetch(`${backend}/session`, { method: "POST" });
  const data = await res.json();
  sessionId = data.sessionId;
  console.log("Session created:", sessionId);
}

async function navigate(url) {
  if (!sessionId) await createSession();
  await fetch(`${backend}/session/${sessionId}/navigate`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url })
  });
  // fallback: display screenshot in iframe
  iframe.src = `${backend}/session/${sessionId}/screenshot?rand=${Math.random()}`;
}

document.getElementById("go-btn").addEventListener("click", () => navigate(input.value));
input.addEventListener("keyup", e => { if(e.key==="Enter") navigate(input.value); });
</script>
</body>
</html>
