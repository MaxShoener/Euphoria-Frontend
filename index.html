<script>
  const iframe = document.getElementById("browser");
  const urlInput = document.getElementById("url");
  const backBtn = document.getElementById("back");
  const forwardBtn = document.getElementById("forward");
  const reloadBtn = document.getElementById("reload");
  const homeBtn = document.getElementById("home");
  const goBtn = document.getElementById("go");
  const fullscreenBtn = document.getElementById("fullscreen");

  const backendURL = "/proxy"; // single route now
  const homePage = "https://www.google.com";

  const historyStack = [];
  let currentIndex = -1;
  let isFullscreen = false;

  function encodeURL(url) {
    if (!/^https?:\/\//i.test(url)) {
      return encodeURIComponent("https://www.google.com/search?q=" + encodeURIComponent(url));
    }
    return encodeURIComponent(url);
  }

  async function loadURL(url) {
    const encoded = encodeURL(url);
    iframe.src = `${backendURL}?url=${encoded}`;

    if (currentIndex < historyStack.length - 1) {
      historyStack.splice(currentIndex + 1);
    }
    historyStack.push(url);
    currentIndex = historyStack.length - 1;
    urlInput.value = url;
  }

  goBtn.addEventListener("click", () => {
    const url = urlInput.value.trim();
    if (url) loadURL(url);
  });

  urlInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      const url = urlInput.value.trim();
      if (url) loadURL(url);
    }
  });

  backBtn.addEventListener("click", () => {
    if (currentIndex > 0) {
      currentIndex--;
      iframe.src = `${backendURL}?url=${encodeURL(historyStack[currentIndex])}`;
      urlInput.value = historyStack[currentIndex];
    }
  });

  forwardBtn.addEventListener("click", () => {
    if (currentIndex < historyStack.length - 1) {
      currentIndex++;
      iframe.src = `${backendURL}?url=${encodeURL(historyStack[currentIndex])}`;
      urlInput.value = historyStack[currentIndex];
    }
  });

  reloadBtn.addEventListener("click", () => {
    if (currentIndex >= 0) {
      iframe.src = `${backendURL}?url=${encodeURL(historyStack[currentIndex])}`;
    }
  });

  homeBtn.addEventListener("click", () => loadURL(homePage));

  fullscreenBtn.addEventListener("click", () => {
    isFullscreen = !isFullscreen;
    iframe.classList.toggle("fullscreen", isFullscreen);
  });

  // Load home page initially
  loadURL(homePage);
</script>
